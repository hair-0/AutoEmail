# 邮件发送工具使用说明

## 简介

这是一个基于Python开发的邮件发送工具，专门用于批量发送邀请邮件。工具支持邮件模板功能，可以自动替换收件人姓名、职称、院系等信息，内置通讯录管理和发送历史记录功能，支持邮件附件，非常适合用于邀请教授担任评委等场景。

## 功能特点

- ✅ **邮件模板功能**：支持使用 `{姓名}`, `{职称}`, `{院系}` 作为占位符，自动替换为收件人信息
- ✅ **模板管理系统**：可以保存、编辑、删除多个邮件模板，方便不同场景使用
- ✅ **邮件撤回功能**：邮件加入发送队列后有30秒延迟，期间可以撤回，防止误发
- ✅ **发送队列管理**：实时查看待发送队列，支持立即发送、撤回、清空等操作
- ✅ **网易邮箱支持**：专为中国用户优化，支持163邮箱发送
- ✅ **通讯录管理**：可以添加、编辑、删除、搜索联系人，支持批量导入导出CSV和Excel
- ✅ **发送历史**：自动记录所有发送记录，支持搜索、查看详情、导出CSV
- ✅ **邮件附件**：支持添加多个附件，自动附加到每封邮件
- ✅ **发送进度**：实时显示发送进度条，避免界面卡顿
- ✅ **SMTP配置**：支持自定义SMTP服务器和端口
- ✅ **优化字体显示**：使用宋体字体，中文显示更清晰，边缘圆润
- ✅ **图形化界面**：简单易用的中文界面，包含五个功能标签页
- ✅ **单文件打包**：可打包成独立exe文件，无需安装Python环境

## 系统要求

- Windows 7/8/10/11
- Python 3.7 或更高版本（仅开发环境需要，使用打包后的exe不需要）
- 网易163邮箱账号或其他支持SMTP的邮箱
- openpyxl库（用于Excel导入，仅开发环境需要，已打包到exe中）

## 快速开始

### 方法一：使用打包后的exe文件（推荐）

1. 双击运行 `邮件发送工具.exe`
2. 在"邮箱设置"中输入你的网易163邮箱地址和授权码
3. 开始使用！

### 方法二：从源码运行

1. 安装Python 3.7或更高版本
2. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```
3. 运行程序：
   ```bash
   python main.py
   ```

## 详细使用说明

### 界面说明

程序包含五个标签页：
1. **发送邮件** - 主功能，用于编辑和发送邮件
2. **发送队列（可撤回）** - 查看和管理待发送的邮件，支持撤回功能
3. **邮件模板** - 管理多个邮件模板
4. **通讯录** - 添加、编辑、导入、导出联系人
5. **历史记录** - 查看所有发送记录

### 1. 首次使用设置

#### 1.1 获取网易邮箱授权码

**重要**：网易邮箱不允许直接使用登录密码发送邮件，需要使用授权码。

1. 登录网易163邮箱网页版
2. 点击设置 → POP3/SMTP/IMAP
3. 开启"POP3/SMTP服务"
4. 点击"授权密码管理"
5. 按照提示发送短信验证
6. 获得16位授权码（如：ABCDEFGHIJKLMNOPQRSTUVWXYZ）

#### 1.2 配置发件邮箱

1. 打开程序，切换到"发送邮件"标签页
2. 在"邮箱设置"区域：
   - 发件邮箱：输入你的完整163邮箱地址（如：yourname@163.com）
   - 授权码：输入刚才获取的16位授权码
   - SMTP服务器：默认为 smtp.163.com，可修改
   - 端口：默认为465，可修改
3. 点击"保存配置"按钮

### 2. 管理通讯录

#### 2.1 添加联系人

1. 切换到"通讯录"标签页
2. 在"添加/编辑联系人"区域填写：
   - 姓名：教授姓名（如：张三）
   - 邮箱：教授邮箱地址（如：zhangsan@xxx.com）
   - 职称：教授职称（如：教授，可选）
   - 院系：所属院系（如：计算机学院，可选）
3. 点击"添加"按钮

#### 2.2 编辑联系人

1. 在联系人列表中点击选择要编辑的联系人
2. 修改表单中的信息
3. 点击"更新"按钮

#### 2.3 删除联系人

1. 在联系人列表中点击选择要删除的联系人
2. 点击"删除选中"按钮
3. 确认删除

#### 2.4 搜索联系人

1. 在搜索框输入关键词（姓名、邮箱、职称或院系）
2. 点击"搜索"按钮
3. 点击"显示全部"可恢复完整列表

#### 2.5 导出通讯录

点击"导出为CSV"按钮，可以将通讯录导出为Excel可打开的CSV文件。

#### 2.6 批量导入联系人

程序支持两种导入方式：

**方式一：CSV文件导入**
1. 准备CSV文件，格式如下（必须包含姓名和邮箱列）：
   ```csv
   姓名,邮箱,职称,院系
   张三,zhangsan@xxx.com,教授,计算机学院
   李四,lisi@yyy.com,副教授,数学学院
   ```
2. 点击"批量导入CSV"按钮
3. 选择CSV文件
4. 查看导入结果

**方式二：Excel文件导入** ✨新增
1. 准备Excel文件（.xlsx或.xls格式），格式如下（必须包含姓名和邮箱列）：
   - 第一行为列名：姓名、邮箱、职称、院系
   - 从第二行开始是数据
2. 点击"批量导入Excel"按钮
3. 选择Excel文件
4. 查看导入结果

**提示**：可以使用程序提供的示例文件"联系人导入示例.xlsx"和"联系人导入示例.csv"作为参考。

### 3. 管理邮件模板

#### 3.1 创建新模板

1. 切换到"邮件模板"标签页
2. 在"添加/编辑模板"区域填写：
   - 模板名称：给模板起个名字（如：邀请评委模板）
   - 邮件主题：邮件的主题
   - 邮件内容：邮件正文，可使用占位符
3. 点击"保存模板"按钮

**占位符说明：**
- `{姓名}` - 会被替换为联系人的姓名
- `{职称}` - 会被替换为联系人的职称（如果没有则留空）
- `{院系}` - 会被替换为联系人的院系（如果没有则留空）

#### 3.2 编辑模板

1. 在模板列表中点击选择要编辑的模板
2. 修改表单中的信息
3. 点击"更新模板"按钮

#### 3.3 删除模板

1. 在模板列表中点击选择要删除的模板
2. 点击"删除选中"按钮
3. 确认删除

#### 3.4 使用模板

**方法一：在发送邮件页面选择模板**
1. 切换到"发送邮件"标签页
2. 在"邮件模板"下拉框中选择模板
3. 邮件内容和主题会自动填充

**方法二：在模板管理页面直接使用**
1. 切换到"邮件模板"标签页
2. 在模板列表中点击选择模板
3. 点击"使用此模板"按钮
4. 自动切换到发送邮件页面并填充内容

### 4. 发送邮件

#### 4.1 发送方式选择

程序提供两种发送方式：

**方式一：立即发送（不可撤回）**
- 点击"立即发送"按钮
- 邮件会立即发送到收件人
- ⚠️ 此操作无法撤回，请谨慎使用

**方式二：加入发送队列（可撤回）** ✨推荐
- 点击"加入发送队列（可撤回）"按钮
- 邮件会在30秒后自动发送
- 在30秒倒计时期间，可以撤回邮件
- 可以随时点击"立即开始发送"取消倒计时
- 适合批量发送，防止误发

#### 4.2 选择或编辑邮件模板

#### 4.1 选择或编辑邮件模板

1. 切换到"发送邮件"标签页
2. 在"邮件模板"下拉框中选择已有模板，或直接编辑邮件主题和内容
3. 可以使用占位符 `{姓名}`, `{职称}`, `{院系}`

**示例模板：**
```text
尊敬的{姓名}{职称}老师：

您好！

我们诚挚地邀请您担任本次[比赛名称]的评委。本次比赛旨在[比赛目的]，将于[时间]在[地点]举行。

作为[专业领域]的专家，您丰富的经验和深厚的学识将为本次比赛提供宝贵的指导和支持。您的参与将确保比赛的公平性和专业性。

如果您能拨冗担任评委，请您回复本邮件确认。我们将随后与您详细沟通具体事宜。

感谢您的时间和支持！

此致
敬礼！

[您的姓名]
[您的联系方式]
[日期]
```

#### 4.2 选择收件人

1. 点击"从通讯录添加"按钮，加载所有联系人
2. 在列表框中选择要发送的收件人（可多选）
3. 使用"移除选中"或"清空列表"调整收件人

#### 4.3 添加附件（可选）

1. 点击"添加附件"按钮
2. 选择要附加的文件
3. 可以添加多个附件
4. 使用"移除附件"删除不需要的附件

#### 4.4 预览邮件

1. 在收件人列表中选择一个收件人
2. 点击"预览邮件"按钮
3. 查看实际发送效果（占位符已被替换）

#### 4.5 立即发送邮件（不可撤回）

1. 确认邮箱设置、邮件内容、收件人和附件都正确
2. 点击"立即发送"按钮
3. 确认发送操作
4. 等待发送完成，查看进度条和成功/失败统计

**注意**：发送过程在后台线程进行，界面不会卡顿，可以实时看到进度。

#### 4.6 加入发送队列（可撤回）✨推荐

1. 确认邮箱设置、邮件内容、收件人和附件都正确
2. 点击"加入发送队列（可撤回）"按钮
3. 系统提示"已将N封邮件加入发送队列，将在30秒后自动发送，期间可以撤回"
4. 切换到"发送队列（可撤回）"标签页查看队列
5. 如需撤回，选择邮件并点击"撤回选中"按钮
6. 如需立即发送，点击"立即开始发送"按钮
7. 30秒倒计时结束后，邮件自动开始发送

### 5. 管理发送队列（撤回功能）✨新增

#### 5.1 查看发送队列

1. 切换到"发送队列（可撤回）"标签页
2. 查看所有待发送的邮件
3. 每封邮件显示：ID、收件人、邮箱、主题、剩余时间、状态

#### 5.2 撤回邮件

1. 在队列列表中选择要撤回的邮件
2. 点击"撤回选中"按钮
3. 确认撤回
4. ⚠️ 注意：只有状态为"等待中"的邮件可以撤回

#### 5.3 立即开始发送

1. 点击"立即开始发送"按钮
2. 所有等待中的邮件将立即开始发送（取消30秒倒计时）
3. 发送开始后无法再撤回

#### 5.4 清空队列

1. 点击"清空队列"按钮
2. 确认清空
3. 所有待发送的邮件将被删除

#### 5.5 刷新队列

点击"刷新队列"按钮，可以刷新队列显示的倒计时和状态。

### 6. 查看发送历史

#### 6.1 浏览历史记录

1. 切换到"历史记录"标签页
2. 查看所有发送记录（按时间倒序排列）
3. 记录包括：收件人、邮箱、主题、发送时间、状态

#### 6.2 查看邮件详情

双击任意历史记录，可以查看完整的邮件内容。

#### 6.3 搜索历史记录

1. 在搜索框输入关键词（收件人、邮箱或主题）
2. 点击"搜索"按钮

#### 6.4 导出历史记录

点击"导出CSV"按钮，可以将历史记录导出为CSV文件。

#### 6.5 清空历史

1. 点击"清空历史"按钮
2. 确认清空（此操作不可恢复）

## 数据存储

程序数据存储在以下位置：

- **数据库文件**：`email_data.db`（与程序同一目录）
- 包含四张表：
  - `contacts`：通讯录
  - `history`：发送历史
  - `config`：配置信息（邮箱、授权码、SMTP设置）
  - `templates`：邮件模板

**备份建议**：定期备份 `email_data.db` 文件，防止数据丢失。

## 常见问题

### Q: 如何撤回已发送的邮件？

**A**:
- 邮件一旦发送到收件人的邮箱服务器，就无法真正撤回
- 但本工具提供了"发送队列"功能，在发送前30秒内可以撤回
- 使用"加入发送队列（可撤回）"方式添加邮件
- 在30秒倒计时期间，切换到"发送队列"标签页，选择邮件并点击"撤回选中"
- 30秒倒计时结束后，邮件开始发送，此时无法撤回

### Q: 发送队列中的邮件状态有哪些？

**A**:
- **等待中**：邮件在30秒倒计时期间，可以撤回
- **发送中**：正在发送邮件，无法撤回
- **已发送**：邮件发送成功
- **失败**：邮件发送失败（会显示失败原因）

### Q: 为什么程序打不开？

**A**:
- 确保下载的是完整的exe文件，没有损坏
- 如果是Windows 10/11，可能被杀毒软件拦截，请添加信任
- 尝试以管理员身份运行
- 如果是源码版本，确保已安装Python 3.7+和所有依赖
- 检查是否有防火墙或安全软件阻止程序运行

### Q1: 提示"登录失败"或"认证失败"

**A**: 
- 确保使用的是网易163邮箱（@163.com）
- 确保使用的是授权码，而不是登录密码
- 检查授权码是否正确（16位字符）
- 确保已开启POP3/SMTP服务

### Q2: 程序无法启动

**A**:
- 确认是exe文件还是Python源码
- 如果是exe文件，确保文件完整未损坏
- 如果是源码，确认Python版本正确且依赖已安装

### Q3: 发送的邮件进入垃圾箱

**A**:
- 这是正常的，第一次批量发送可能被识别为垃圾邮件
- 可以在邮箱设置中添加发件人到白名单
- 减少单次发送数量，分批发送
- 使用授权码而非登录密码可以提高信誉度

### Q4: 邮件内容乱码

**A**:
- 确保邮件模板使用UTF-8编码
- 程序已默认设置为UTF-8编码，一般不会出现此问题
- 如果从Excel复制内容，注意粘贴时的编码

### Q5: 如何迁移数据到其他电脑

**A**:
- 复制 `email_data.db` 文件
- 粘贴到新电脑的程序目录下
- 数据会自动加载

### Q6: 批量导入时提示格式错误

**A**:
- CSV文件：
  - 确保CSV文件包含"姓名"和"邮箱"列（必须）
  - 其他列"职称"和"院系"是可选的
  - 使用UTF-8编码保存CSV文件
  - 第一行应为列名

- Excel文件：
  - 确保Excel文件（.xlsx或.xls格式）包含"姓名"和"邮箱"列（必须）
  - 第一行应为列名
  - 从第二行开始是数据
  - 确保数据没有被合并单元格

### Q7: 附件无法发送

**A**:
- 检查附件文件是否存在
- 确保附件文件没有被其他程序占用
- 某些邮箱服务商限制附件大小（一般不超过20MB）
- 尝试压缩大文件后再发送

### Q8: 可以使用其他邮箱吗？

**A**:
- 可以！程序支持自定义SMTP服务器
- 在"邮箱设置"中修改SMTP服务器和端口
- 例如：
  - QQ邮箱：smtp.qq.com，端口465
  - Gmail：smtp.gmail.com，端口587
  - Outlook：smtp-mail.outlook.com，端口587

## 安全建议

1. **保护授权码**：不要将包含授权码的数据库文件分享给他人
2. **定期备份**：定期备份 `email_data.db` 文件
3. **使用强授权码**：设置复杂的授权码，并定期更换
4. **谨慎发送**：发送前预览邮件，确保内容正确
5. **测试发送**：先给自己发送测试邮件，确认一切正常

## 技术支持

如有问题或建议，请联系开发者。

## 更新日志

### v2.3.0 (2026-01-18) - UI优化版
- ✨ 新增Excel文件批量导入联系人功能，支持.xlsx和.xls格式
- ✨ 优化字体显示，改用宋体，中文显示更清晰
- ✨ 优化UI布局，修复标题重叠问题
- ✨ 优化按钮和边框样式，使用圆润边缘设计
- ✨ 优化组件间距和padding，界面更美观
- ✨ 增大窗口尺寸（1280x880），提供更好的显示效果
- ✨ 更新打包配置，添加tkinter和openpyxl的hidden-import
- 🐛 修复exe文件DLL加载失败的问题
- 🐛 修复字体边缘模糊的问题
- 🐛 修复UI组件遮挡的问题

### v2.2.0 (2026-01-18) - 增强版
- ✨ 新增发送队列管理功能，支持30秒延迟发送
- ✨ 新增邮件撤回功能，防止误发邮件
- ✨ 新增"发送队列（可撤回）"标签页
- ✨ 优化字体显示，使用微软雅黑UI字体
- 🐛 修复启动问题

### v2.1.0 (2026-01-18) - 撤回功能版
- ✨ 新增邮件撤回功能，30秒倒计时期间可撤回邮件
- ✨ 新增"发送队列（可撤回）"标签页，实时管理待发送邮件
- ✨ 新增发送队列处理器，支持延迟发送和撤回操作

### v2.0.0 (2026-01-18) - 增强版
- ✨ 新增邮件模板管理系统，支持保存、编辑、删除多个模板
- ✨ 新增邮件附件功能，支持添加多个附件
- ✨ 新增SMTP自定义配置，支持其他邮箱服务商
- ✨ 新增发送进度条，实时显示发送进度
- ✨ 新增批量导入联系人功能，支持CSV批量导入
- ✨ 新增历史记录导出功能
- ✨ 优化占位符系统，支持 `{姓名}`, `{职称}`, `{院系}`
- ✨ 优化发送逻辑，使用多线程避免界面卡顿
- ✨ 优化用户界面，新增"邮件模板"标签页
- 🐛 修复若干bug

### v1.0.0 (2026-01-18)
- 初始版本发布
- 支持邮件模板发送
- 通讯录管理功能
- 发送历史记录
- 图形化界面

## 许可证

本工具仅供学习和个人使用。
